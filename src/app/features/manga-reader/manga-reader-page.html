<div class="min-h-screen text-dash-text p-4 md:p-8 font-sans selection:bg-dash-accent selection:text-white pb-16">
    <div class="max-w-7xl mx-auto flex flex-col gap-4">

        <!-- Header -->
        <header
            class="flex items-center justify-between gradient-header p-3 md:p-4 rounded-sm sticky top-0 z-50 shadow-lg">
            <div class="flex items-center gap-2 md:gap-4">
                <button (click)="toggleSidebar()"
                    class="w-10 h-10 bg-dash-bg rounded-sm flex items-center justify-center hover:bg-dash-accent cursor-pointer text-dash-text-dim hover:text-white transition-all"
                    title="Menu">
                    <span class="material-symbols-sharp text-xl">menu</span>
                </button>
                <h1 class="text-xs md:text-sm font-bold tracking-widest text-dash-text-dim uppercase">Manga Reader</h1>
                <span *ngIf="fileName()" class="text-xs text-dash-text-dim truncate max-w-[200px]">{{ fileName()
                    }}</span>
            </div>
            <div class="flex gap-2 md:gap-4 items-center">
                <button (click)="goToBuilder()"
                    class="px-3 py-2 bg-dash-bg rounded-sm flex items-center gap-2 hover:bg-dash-accent cursor-pointer text-dash-text-dim hover:text-white transition-all text-xs">
                    <span class="material-symbols-sharp text-sm">auto_stories</span>
                    <span class="hidden md:inline">Builder</span>
                </button>
                <label
                    class="px-3 py-2 bg-dash-bg rounded-sm flex items-center gap-2 hover:bg-dash-accent cursor-pointer text-dash-text-dim hover:text-white transition-all text-xs">
                    <span class="material-symbols-sharp text-sm">folder_open</span>
                    <span class="hidden md:inline">Öffnen</span>
                    <input type="file" accept=".cbz,.zip" (change)="onFileSelect($event)" class="hidden">
                </label>
            </div>
        </header>

        <!-- Reader Area -->
        <div *ngIf="pages().length > 0; else emptyState"
            class="gradient-card rounded-sm flex flex-col items-center relative" [class.fixed]="isFullscreen()"
            [class.inset-0]="isFullscreen()" [class.z-[100]]="isFullscreen()" [class.rounded-none]="isFullscreen()"
            (mousemove)="onMouseMove()">

            <!-- Page Container -->
            <div class="flex-1 w-full flex items-center justify-center p-4 cursor-pointer min-h-[60vh]"
                (click)="onPageClick($event)">
                <img [src]="getCurrentPageUrl()" [alt]="'Seite ' + (currentPage() + 1)"
                    class="max-w-full max-h-[70vh] object-contain select-none" [class.max-h-screen]="isFullscreen()">
            </div>

            <!-- Navigation Controls -->
            <div class="flex items-center gap-4 p-4 bg-dash-bg/80 backdrop-blur-sm rounded-sm mb-4"
                [class.opacity-0]="isFullscreen() && !showControls()" [class.transition-opacity]="true">
                <button (click)="prevPage(); $event.stopPropagation()" [disabled]="currentPage() === 0"
                    class="w-10 h-10 bg-dash-border rounded-sm flex items-center justify-center hover:bg-dash-accent cursor-pointer text-dash-text-dim hover:text-white transition-all disabled:opacity-30 disabled:cursor-not-allowed">
                    <span class="material-symbols-sharp">chevron_left</span>
                </button>

                <div class="flex items-center gap-2 text-sm font-mono">
                    <span class="text-dash-accent font-bold">{{ currentPage() + 1 }}</span>
                    <span class="text-dash-text-dim">/</span>
                    <span class="text-dash-text-dim">{{ pages().length }}</span>
                </div>

                <button (click)="nextPage(); $event.stopPropagation()" [disabled]="currentPage() >= pages().length - 1"
                    class="w-10 h-10 bg-dash-border rounded-sm flex items-center justify-center hover:bg-dash-accent cursor-pointer text-dash-text-dim hover:text-white transition-all disabled:opacity-30 disabled:cursor-not-allowed">
                    <span class="material-symbols-sharp">chevron_right</span>
                </button>

                <button (click)="toggleFullscreen(); $event.stopPropagation()"
                    class="w-10 h-10 bg-dash-border rounded-sm flex items-center justify-center hover:bg-dash-accent cursor-pointer text-dash-text-dim hover:text-white transition-all ml-2">
                    <span class="material-symbols-sharp">{{ isFullscreen() ? 'fullscreen_exit' : 'fullscreen' }}</span>
                </button>
            </div>

            <!-- Page Slider -->
            <div class="w-full max-w-md px-4 pb-4" [class.opacity-0]="isFullscreen() && !showControls()">
                <input type="range" [min]="0" [max]="pages().length - 1" [value]="currentPage()"
                    (input)="goToPage(+$any($event.target).value)"
                    class="w-full h-1 bg-dash-border rounded-sm appearance-none cursor-pointer accent-dash-accent">
            </div>
        </div>

        <!-- Empty State -->
        <ng-template #emptyState>
            <div class="gradient-card rounded-sm flex flex-col items-center justify-center py-16 px-4 text-center">
                <span class="material-symbols-sharp text-6xl text-dash-text-dim mb-4">menu_book</span>
                <h2 class="text-lg font-bold text-dash-text mb-2">Kein Manga geladen</h2>
                <p class="text-sm text-dash-text-dim mb-6">Öffne eine CBZ- oder ZIP-Datei zum Lesen</p>
                <label
                    class="gradient-btn text-white px-4 py-2 rounded-sm text-sm font-medium flex items-center gap-2 cursor-pointer">
                    <span class="material-symbols-sharp">folder_open</span>
                    Datei öffnen
                    <input type="file" accept=".cbz,.zip" (change)="onFileSelect($event)" class="hidden">
                </label>
                <div class="mt-8 text-left text-xs text-dash-text-dim">
                    <p class="mb-2 font-medium">Tastaturkürzel:</p>
                    <ul class="space-y-1">
                        <li><kbd class="px-1.5 py-0.5 bg-dash-bg rounded text-[10px]">←</kbd> <kbd
                                class="px-1.5 py-0.5 bg-dash-bg rounded text-[10px]">→</kbd> Seiten wechseln</li>
                        <li><kbd class="px-1.5 py-0.5 bg-dash-bg rounded text-[10px]">F</kbd> Vollbildmodus</li>
                        <li><kbd class="px-1.5 py-0.5 bg-dash-bg rounded text-[10px]">Home</kbd> / <kbd
                                class="px-1.5 py-0.5 bg-dash-bg rounded text-[10px]">End</kbd> Erste / Letzte Seite</li>
                    </ul>
                </div>
            </div>
        </ng-template>

        <!-- Loading Overlay -->
        <div *ngIf="isLoading()"
            class="fixed inset-0 bg-black/80 flex flex-col items-center justify-center gap-4 z-[200]">
            <span class="material-symbols-sharp text-4xl text-dash-accent animate-spin">refresh</span>
            <span class="text-dash-text">Lade...</span>
        </div>

    </div>
</div>