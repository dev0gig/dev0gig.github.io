<div class="min-h-screen text-dash-text p-4 md:p-8 font-sans selection:bg-dash-accent selection:text-white pb-16">
    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-12 gap-4">

        <!-- Header -->
        <header
            class="md:col-span-12 flex items-center justify-between gradient-header p-3 md:p-4 rounded-sm sticky top-0 z-50 shadow-lg">
            <div class="flex items-center gap-2 md:gap-4">
                <!-- Apps Launcher -->
                <app-apps-launcher (openSettings)="toggleSettingsModal()"></app-apps-launcher>
                <h1 class="text-xs md:text-sm font-bold tracking-widest text-dash-text-dim uppercase">Budget</h1>
            </div>
            <div class="flex gap-2 md:gap-4 text-xs font-mono text-dash-text-dim items-center">
                <!-- View Toggle Switch -->
                <div class="flex items-center gap-1 md:gap-2 bg-dash-bg rounded-sm p-1 border border-dash-border">
                    <button (click)="toggleViewMode('transactions')"
                        [class]="viewMode() === 'transactions' ? 'px-2 md:px-3 py-1.5 rounded-sm text-xs font-medium transition-colors bg-dash-accent text-white' : 'px-2 md:px-3 py-1.5 rounded-sm text-xs font-medium transition-colors text-dash-text-dim hover:text-white'">
                        <span class="material-symbols-sharp text-sm align-middle md:mr-1">receipt_long</span>
                        <span class="hidden md:inline">Transaktionen</span>
                    </button>
                    <button (click)="toggleViewMode('statistics')"
                        [class]="viewMode() === 'statistics' ? 'px-2 md:px-3 py-1.5 rounded-sm text-xs font-medium transition-colors bg-dash-accent text-white' : 'px-2 md:px-3 py-1.5 rounded-sm text-xs font-medium transition-colors text-dash-text-dim hover:text-white'">
                        <span class="material-symbols-sharp text-sm align-middle md:mr-1">analytics</span>
                        <span class="hidden md:inline">Statistik</span>
                    </button>
                    <button (click)="toggleViewMode('fixedcosts')"
                        [class]="viewMode() === 'fixedcosts' ? 'px-2 md:px-3 py-1.5 rounded-sm text-xs font-medium transition-colors bg-dash-accent text-white' : 'px-2 md:px-3 py-1.5 rounded-sm text-xs font-medium transition-colors text-dash-text-dim hover:text-white'">
                        <span class="material-symbols-sharp text-sm align-middle md:mr-1">bookmark</span>
                        <span class="hidden md:inline">Fixkosten</span>
                    </button>
                </div>
                <div class="hidden sm:block">STATUS
                    <span [class.text-dash-accent]="isOnline()" [class.text-red-500]="!isOnline()">
                        {{ isOnline() ? 'ONLINE' : 'OFFLINE' }}
                    </span>
                </div>
                <div class="hidden sm:block">TRANSACTIONS <span class="text-white">{{ transactions().length }}</span>
                </div>
                <!-- Right Sidebar Toggle -->
                <button (click)="toggleRightSidebar()"
                    class="w-10 h-10 bg-dash-bg rounded-sm flex items-center justify-center hover:bg-dash-accent cursor-pointer text-dash-text-dim hover:text-white transition-all"
                    title="Rechte Sidebar">
                    <span class="material-symbols-sharp text-xl">menu_open</span>
                </button>
            </div>
        </header>

        <!-- Settings Modal -->
        @if (showSettingsModal()) {
        <app-settings-modal [accounts]="accounts()" [categories]="categories()" (close)="toggleSettingsModal()"
            (importData)="triggerImport()" (exportData)="triggerExport()"
            (deleteAllTransactions)="deleteAllTransactions()" (addAccount)="toggleAccountModal()"
            (editAccount)="openEditAccountModal($event)" (deleteAccount)="deleteAccount($event)"
            (addCategory)="toggleCategoryModal()" (editCategory)="openEditCategoryModal($event)"
            (deleteCategory)="deleteCategory($event)">
        </app-settings-modal>
        }

        <!-- Main Content Area -->
        <main class="md:col-span-8 lg:col-span-9 flex flex-col gap-4 order-2 md:order-1">

            <!-- TRANSACTIONS VIEW -->
            @if (viewMode() === 'transactions') {
            <app-transactions-view [transactions]="getSortedTransactions()" [accounts]="accounts()"
                [categories]="categories()" [searchQuery]="searchQuery()" (addTransaction)="toggleTransactionModal()"
                (editTransaction)="openEditModal($event)" (deleteTransaction)="deleteTransaction($event)"
                (copyToFixedCost)="copyTransactionToFixedCost($event)" (search)="stateService.onSearch($event)">
            </app-transactions-view>
            }

            <!-- STATISTICS VIEW -->
            @if (viewMode() === 'statistics') {
            <app-statistics-view [stats]="getStats()" [categoryStats]="getCategoryStats()"
                [incomeCategoryStats]="getIncomeCategoryStats()" [dailyTrend]="getDailyTrend()"
                [topExpenses]="getTopExpenses()" [selectedMonthName]="getSelectedMonthName()"
                [selectedAccountName]="selectedAccountId() ? (getAccountById(selectedAccountId()!)?.name ?? null) : null"
                [transactionCount]="getSortedTransactions().length"
                [incomeTransactionCount]="getIncomeTransactionCount()"
                [expenseTransactionCount]="getExpenseTransactionCount()"
                [averageDailyExpense]="getAverageDailyExpense()" [averageDailyIncome]="getAverageDailyIncome()"
                [largestExpense]="getLargestExpense()" [largestIncome]="getLargestIncome()"
                [pieChartGradient]="getPieChartGradient()" [incomePieChartGradient]="getIncomePieChartGradient()"
                [trendPoints]="getTrendPoints()" [trendAreaPoints]="getTrendAreaPoints()"
                [trendMaxValue]="getTrendMaxValue()" [trendMinValue]="getTrendMinValue()" [zeroLineY]="getZeroLineY()"
                [daysInSelectedMonth]="getDaysInSelectedMonth()">
            </app-statistics-view>
            }

            <!-- FIXKOSTEN VIEW -->
            @if (viewMode() === 'fixedcosts') {
            <app-fixed-costs-view [fixedCosts]="getFixedCostsSortedByCategory()" [accounts]="accounts()"
                [categories]="categories()" [fixedIncomeTotal]="getFixedIncomeTotal()"
                [fixedCostsTotal]="getFixedCostsTotal()" [fixedIncomeCount]="getFixedIncomeCount()"
                [fixedExpenseCount]="getFixedExpenseCount()" (addFixedCost)="toggleFixedCostModal()"
                (editFixedCost)="openEditFixedCostModal($event)" (deleteFixedCost)="deleteFixedCost($event)"
                (createTransaction)="createTransactionFromFixedCost($event)">
            </app-fixed-costs-view>
            }

        </main>

        <!-- Sidebar -->
        <aside class="md:col-span-4 lg:col-span-3 flex flex-col gap-4 order-1 md:order-2">
            <app-budget-sidebar [stats]="getStats()" [accounts]="accounts()" [transactions]="transactions()"
                [selectedAccountId]="selectedAccountId()" [totalBalance]="getTotalBalance()"
                (selectAccount)="selectAccount($event)" (monthChange)="onMonthChange($event)">
            </app-budget-sidebar>
        </aside>

        <!-- Transaction Modal -->
        @if (showTransactionModal()) {
        <app-transaction-modal [editingTransaction]="editingTransaction()"
            [prefillFromFixedCost]="prefillFromFixedCost()" [accounts]="accounts()" [categories]="categories()"
            (close)="toggleTransactionModal(); editingTransaction.set(null); clearPrefillData()"
            (submit)="onTransactionModalSubmit($event)">
        </app-transaction-modal>
        }

        <!-- Account Modal -->
        @if (showAccountModal()) {
        <app-account-modal [editingAccount]="editingAccount()" (close)="toggleAccountModal(); editingAccount.set(null)"
            (submit)="onAccountModalSubmit($event)">
        </app-account-modal>
        }

        <!-- Category Modal -->
        @if (showCategoryModal()) {
        <app-category-modal [editingCategory]="editingCategory()"
            (close)="toggleCategoryModal(); editingCategory.set(null)" (submit)="onCategoryModalSubmit($event)">
        </app-category-modal>
        }

        <!-- Fixed Cost Modal -->
        @if (showFixedCostModal()) {
        <app-fixed-cost-modal [editingFixedCost]="editingFixedCost()" [accounts]="accounts()"
            [categories]="categories()" (close)="toggleFixedCostModal()" (submit)="onFixedCostModalSubmit($event)">
        </app-fixed-cost-modal>
        }
    </div>
</div>