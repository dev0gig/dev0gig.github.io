import{Ia as w,K as l,L as v,_a as g,aa as E,kb as F,ra as y,sa as M,u as h,ub as T,y as b,za as x}from"./chunk-3T5KDFEF.js";import{a as m,b as f}from"./chunk-LS4SCMUJ.js";var N=class o{sidebarService=b(T);toggleSidebar(){this.sidebarService.toggle()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=E({type:o,selectors:[["app-apps-launcher"]],decls:3,vars:0,consts:[["title","Navigation",1,"w-10","h-10","bg-dash-bg","rounded-sm","flex","items-center","justify-center","hover:bg-dash-accent","cursor-pointer","text-dash-text-dim","hover:text-white","transition-all",3,"click"],[1,"material-symbols-sharp","text-xl"]],template:function(e,a){e&1&&(y(0,"button",0),x("click",function(){return a.toggleSidebar()}),y(1,"span",1),w(2,"menu"),M()())},dependencies:[F],encapsulation:2})};var J=class o{STORAGE_KEY="terminal_journal_entries";entriesSignal=l(this.loadEntries(),{});searchQuerySignal=l("",{});isInitialized=!1;currentDate=l(new Date,{});entries=this.entriesSignal.asReadonly();storageUsage=l("0 KB",{});selectedMonthFilter=l(null,{});monthFilter=this.selectedMonthFilter.asReadonly();showDuplicatesOnly=l(!1,{});duplicateFilter=this.showDuplicatesOnly.asReadonly();displayEntries=g(()=>{let t=this.searchQuerySignal().toLowerCase(),e=this.selectedMonthFilter(),a=this.showDuplicatesOnly(),r=this.entriesSignal();if(e&&(r=r.filter(s=>s.date.getFullYear()===e.year&&s.date.getMonth()===e.month)),a){let s=this.duplicateDates();r=r.filter(i=>s.has(this.getDateKey(i.date)))}return t&&(r=r.filter(s=>s.text.toLowerCase().includes(t))),r.sort((s,i)=>i.date.getTime()-s.date.getTime())},{});duplicateDates=g(()=>{let t=this.entriesSignal(),e=new Map;for(let n of t){let r=this.getDateKey(n.date);e.set(r,(e.get(r)||0)+1)}let a=new Set;for(let[n,r]of e)r>1&&a.add(n);return a},{});hasDuplicateDate(t){let e=this.getDateKey(t.date);return this.duplicateDates().has(e)}duplicateEntriesCount=g(()=>{let t=this.entriesSignal(),e=this.duplicateDates();return t.filter(a=>e.has(this.getDateKey(a.date))).length},{});getDateKey(t){let e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${n}`}monthlyEntryCounts=g(()=>{let t=this.entriesSignal(),e=new Date().getFullYear(),a=[],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let r=0;r<12;r++){let s=t.filter(i=>i.date.getFullYear()===e&&i.date.getMonth()===r).length;a.push({month:r,name:n[r],count:s})}return a},{});constructor(){v(()=>{let t=this.entriesSignal();if(!this.isInitialized){this.isInitialized=!0;return}this.saveEntries(t)}),this.calculateUsage()}setSearchQuery(t){this.searchQuerySignal.set(t)}setCurrentDate(t){this.currentDate.set(t)}setMonthFilter(t,e){this.selectedMonthFilter.set({year:t,month:e}),this.currentDate.set(new Date(t,e,1))}clearMonthFilter(){this.selectedMonthFilter.set(null)}setDuplicateFilter(t){this.showDuplicatesOnly.set(t),t&&this.selectedMonthFilter.set(null)}clearDuplicateFilter(){this.showDuplicatesOnly.set(!1)}prevMonth(){this.currentDate.update(t=>{let e=new Date(t);return e.setMonth(t.getMonth()-1),e})}nextMonth(){this.currentDate.update(t=>{let e=new Date(t);return e.setMonth(t.getMonth()+1),e})}goToToday(){this.currentDate.set(new Date)}addEntry(t){let e={id:crypto.randomUUID(),date:new Date,text:t};this.entriesSignal.update(a=>[e,...a])}addEntryWithDate(t,e){let a={id:crypto.randomUUID(),date:e,text:t};this.entriesSignal.update(n=>[a,...n])}cleanOcrText(t){let e=t.split(`
`).map(r=>r.replace(/  +/g," ").replace(/ ([.,!?;:])/g,"$1").replace(/([(\[â€ž"']) /g,"$1").replace(/ ([)\]"'"])/g,"$1").trim()).filter(r=>r.length>0);if(e.length===0)return"";let a=[e[0]],n="";for(let r=1;r<e.length;r++){let s=e[r];s.startsWith("-")?(n&&(a.push(n),n=""),n="- "+s.substring(1).trim()):n?n.endsWith("-")?n=n.slice(0,-1)+s:n+=" "+s:n=s}return n&&a.push(n),a.join(`
`)}parseDateFromText(t){let e=t.split(`
`);if(e.length===0)return{date:null,remainingText:t};let n=e[0].trim().match(/^(\d{1,2})[./-](\d{1,2})[./-](\d{4})$/);if(n){let r=parseInt(n[1],10),s=parseInt(n[2],10)-1,i=parseInt(n[3],10),u=new Date(i,s,r);if(!isNaN(u.getTime())&&u.getDate()===r){let c=e.slice(1).join(`
`).trim();return{date:u,remainingText:c}}}return{date:null,remainingText:t}}importOcrText(t){let e=this.cleanOcrText(t),{date:a,remainingText:n}=this.parseDateFromText(e);return a?n.trim()?(this.addEntryWithDate(n,a),this.currentDate.set(a),{success:!0,date:a}):{success:!1,date:null,error:"No text content found after date line"}:{success:!1,date:null,error:"Could not parse date from first line. Expected format: DD.MM.YYYY"}}deleteEntry(t){this.entriesSignal.update(e=>e.filter(a=>a.id!==t))}deleteAllEntries(){this.entriesSignal.set([])}updateEntry(t,e){this.entriesSignal.update(a=>a.map(n=>n.id===t?f(m({},n),{text:e}):n))}getEntriesByDate(t){return this.entriesSignal().filter(e=>this.isSameDay(e.date,t))}loadEntries(){let t=localStorage.getItem(this.STORAGE_KEY);if(!t)return[];try{return JSON.parse(t).map(e=>f(m({},e),{date:new Date(e.date)}))}catch{return[]}}saveEntries(t){let e=JSON.stringify(t);localStorage.setItem(this.STORAGE_KEY,e),this.calculateUsage()}async calculateUsage(){if(navigator.storage&&navigator.storage.estimate)try{let n=(await navigator.storage.estimate()).usage||0;n<1024?this.storageUsage.set(`${n} B`):n<1024*1024?this.storageUsage.set(`${(n/1024).toFixed(2)} KB`):this.storageUsage.set(`${(n/(1024*1024)).toFixed(2)} MB`);return}catch(a){console.warn("Storage estimate failed",a)}let t=localStorage.getItem(this.STORAGE_KEY)||"",e=new Blob([t]).size;e<1024?this.storageUsage.set(`${e} B`):this.storageUsage.set(`${(e/1024).toFixed(2)} KB`)}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}async exportData(){let t=(await import("./chunk-7DPAS54S.js")).default,e=new t,a=this.entriesSignal(),n=new Map;for(let r of a){let s=r.date.getFullYear(),i=String(r.date.getMonth()+1).padStart(2,"0"),u=String(r.date.getDate()).padStart(2,"0"),c=`${s}-${i}-${u}`,d=n.get(c)||[];d.push(r.text),n.set(c,d)}for(let[r,s]of n){let i=s.join(`

---

`);e.file(`${r}.txt`,i)}return e.generateAsync({type:"blob"})}async importData(t){let a=await(await import("./chunk-7DPAS54S.js")).default.loadAsync(t),n=[];for(let[r,s]of Object.entries(a.files)){if(s.dir||!r.endsWith(".txt"))continue;let c=(r.split("/").pop()||r).replace(".txt","").split("-").map(Number);if(c.length!==3)continue;let[d,U,Y]=c,D=new Date(d,U-1,Y);if(isNaN(D.getTime()))continue;let p=await s.async("string");if(!p||!p.trim())continue;let $=p.split(/\n\n---\n\n/);for(let S of $)S.trim()&&n.push({id:crypto.randomUUID(),date:D,text:S.trim()})}return n.length>0&&(n.sort((r,s)=>s.date.getTime()-r.date.getTime()),this.saveEntries(n),this.entriesSignal.set(n),this.currentDate.set(n[0].date)),n.length}static \u0275fac=function(e){return new(e||o)};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};var O=class o{settingsTrigger=l(0,{});get trigger(){return this.settingsTrigger.asReadonly()}openSettings(){this.settingsTrigger.update(t=>t+1)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})};export{N as a,J as b,O as c};
