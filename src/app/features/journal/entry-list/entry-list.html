<div class="flex flex-col h-full">
    <!-- Entries (Scrollable) -->
    <div class="flex-1 overflow-y-auto flex flex-col custom-scrollbar">
        <div class="p-6 flex flex-col gap-4">
            @for (entry of filteredEntries(); track entry.id) {
            <div class="bg-dash-bg/30 rounded-sm p-4 transition-all group relative border-2 border-dash-border/50 hover:border-dash-accent/50"
                [class.edit-mode-border]="editingEntryId === entry.id">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-2">
                        @if (editingDateId === entry.id) {
                        <input type="date" [value]="getIsoDate(entry.date)"
                            class="bg-dash-bg border border-dash-border rounded px-1 py-0.5 text-xs text-dash-text text-[10px] w-32 focus:outline-none focus:border-dash-accent"
                            (change)="saveDateEdit(entry, $event)" (blur)="cancelDateEdit()" autofocus>
                        } @else {
                        <span class="text-xs font-mono text-dash-accent">{{ entry.date | date:'MMM dd, yyyy Â·
                            HH:mm':'Europe/Vienna' }}</span>
                        <button class="text-dash-text-dim hover:text-dash-accent transition-colors"
                            (click)="startEditingDate(entry)" title="Edit Date">
                            <span class="material-symbols-sharp text-[10px]">edit</span>
                        </button>
                        }
                    </div>
                    <button class="text-dash-text-dim hover:text-red-400 transition-opacity"
                        (click)="deleteEntry(entry.id)" title="Delete">
                        <span class="material-symbols-sharp text-sm">delete</span>
                    </button>
                </div>

                <div class="relative">
                    @if (editingEntryId === entry.id) {
                    <textarea #editTextarea [(ngModel)]="editEntryText" (blur)="saveEdit()"
                        class="w-full bg-transparent text-sm text-dash-text resize-none focus:outline-none leading-relaxed whitespace-pre-wrap"
                        [style.height.px]="editingHeight" autofocus></textarea>
                    } @else {
                    <div (click)="startEditing(entry, $event)"
                        class="whitespace-pre-wrap text-sm text-dash-text/90 leading-relaxed cursor-pointer hover:text-dash-text transition-colors">
                        @for (segment of parseTextWithTags(entry.text); track $index) {
                        @if (segment.type === 'text') {
                        <span>{{ segment.content }}</span>
                        } @else if (segment.type === 'highlight') {
                        <mark class="search-highlight">{{ segment.content }}</mark>
                        } @else {
                        <button (click)="onTagClick(segment.content, $event)" class="inline-tag-pill"
                            [style.background-color]="getTagColor(segment.content)"
                            title="Click to filter by #{{ segment.content }}">#{{ segment.content }}</button>
                        }
                        }
                    </div>
                    }
                </div>
            </div>
            } @empty {
            <div class="flex flex-col items-center justify-center h-full text-dash-text-dim opacity-50 py-12">
                <span class="material-symbols-sharp text-4xl mb-2">inbox</span>
                <span>No entries found</span>
            </div>
            }
        </div>
    </div>
</div>