import{b as D}from"./chunk-TXJOOSIC.js";import{a as R,b as V}from"./chunk-LBHE74U5.js";import{A as m,Aa as p,B as g,Ea as E,Ga as f,Ia as r,Ja as _,K as x,T as w,U as P,V as o,Za as k,aa as y,ea as b,gb as M,kb as T,na as u,oa as t,pa as i,pb as C,qa as S,ub as F,wa as v,y as h,ya as d}from"./chunk-3T5KDFEF.js";import"./chunk-LS4SCMUJ.js";function j(c,n){if(c&1&&(t(0,"span",17),r(1),i()),c&2){let e=p();o(),_(e.fileName())}}function L(c,n){if(c&1){let e=v();t(0,"div",18),d("mousemove",function(){m(e);let a=p();return g(a.onMouseMove())}),t(1,"div",19),d("click",function(a){m(e);let l=p();return g(l.onPageClick(a))}),S(2,"img",20),i(),t(3,"div",21)(4,"button",22),d("click",function(a){return m(e),p().prevPage(),g(a.stopPropagation())}),t(5,"span",23),r(6,"chevron_left"),i()(),t(7,"div",24)(8,"span",25),r(9),i(),t(10,"span",26),r(11,"/"),i(),t(12,"span",26),r(13),i()(),t(14,"button",22),d("click",function(a){return m(e),p().nextPage(),g(a.stopPropagation())}),t(15,"span",23),r(16,"chevron_right"),i()(),t(17,"button",27),d("click",function(a){return m(e),p().toggleFullscreen(),g(a.stopPropagation())}),t(18,"span",23),r(19),i()()(),t(20,"div",28)(21,"input",29),d("input",function(a){m(e);let l=p();return g(l.goToPage(+a.target.value))}),i()()()}if(c&2){let e=p();f("fixed",e.isFullscreen())("inset-0",e.isFullscreen())("z-[100]",e.isFullscreen())("rounded-none",e.isFullscreen()),o(2),f("max-h-screen",e.isFullscreen()),u("src",e.getCurrentPageUrl(),w)("alt","Seite "+(e.currentPage()+1)),o(),f("opacity-0",e.isFullscreen()&&!e.showControls())("transition-opacity",!0),o(),u("disabled",e.currentPage()===0),o(5),_(e.currentPage()+1),o(4),_(e.pages().length),o(),u("disabled",e.currentPage()>=e.pages().length-1),o(5),_(e.isFullscreen()?"fullscreen_exit":"fullscreen"),o(),f("opacity-0",e.isFullscreen()&&!e.showControls()),o(),u("min",0)("max",e.pages().length-1)("value",e.currentPage())}}function U(c,n){if(c&1){let e=v();t(0,"div",30)(1,"span",31),r(2,"menu_book"),i(),t(3,"h2",32),r(4,"Kein Manga geladen"),i(),t(5,"p",33),r(6,"\xD6ffne eine CBZ- oder ZIP-Datei zum Lesen"),i(),t(7,"label",34)(8,"span",23),r(9,"folder_open"),i(),r(10," Datei \xF6ffnen "),t(11,"input",14),d("change",function(a){m(e);let l=p();return g(l.onFileSelect(a))}),i()(),t(12,"div",35)(13,"p",36),r(14,"Tastaturk\xFCrzel:"),i(),t(15,"ul",37)(16,"li")(17,"kbd",38),r(18,"\u2190"),i(),t(19,"kbd",38),r(20,"\u2192"),i(),r(21," Seiten wechseln"),i(),t(22,"li")(23,"kbd",38),r(24,"F"),i(),r(25," Vollbildmodus"),i(),t(26,"li")(27,"kbd",38),r(28,"Home"),i(),r(29," / "),t(30,"kbd",38),r(31,"End"),i(),r(32," Erste / Letzte Seite"),i()()()()}}function z(c,n){c&1&&(t(0,"div",39)(1,"span",40),r(2,"refresh"),i(),t(3,"span",41),r(4,"Lade..."),i()())}var I=class c{fileProcessor=h(R);imageOptimiser=h(V);router=h(C);sidebarService=h(F);themeService=h(D);pages=x([],{});currentPage=x(0,{});isLoading=x(!1,{});fileName=x("",{});isFullscreen=x(!1,{});showControls=x(!0,{});controlTimeout;pageUrls=[];ngOnDestroy(){this.revokeAllUrls()}toggleSidebar(){this.sidebarService.toggle()}async onFileSelect(n){let e=n.target;!e.files||e.files.length===0||(await this.loadFile(e.files[0]),e.value="")}async loadFile(n){this.isLoading.set(!0),this.revokeAllUrls();try{let s=(await this.fileProcessor.extractArchive(n)).map(a=>({url:this.imageOptimiser.createObjectUrl(a.data,a.type),name:a.name}));this.pageUrls=s.map(a=>a.url),this.pages.set(s),this.currentPage.set(0),this.fileName.set(n.name)}catch(e){console.error("Error loading file:",e)}finally{this.isLoading.set(!1),this.fileProcessor.resetProgress()}}revokeAllUrls(){for(let n of this.pageUrls)this.imageOptimiser.revokeObjectUrl(n);this.pageUrls=[]}onKeyDown(n){if(this.pages().length!==0)switch(n.key){case"ArrowRight":case" ":this.nextPage(),n.preventDefault();break;case"ArrowLeft":this.prevPage(),n.preventDefault();break;case"Home":this.goToPage(0),n.preventDefault();break;case"End":this.goToPage(this.pages().length-1),n.preventDefault();break;case"f":case"F":this.toggleFullscreen();break;case"Escape":this.isFullscreen()&&this.toggleFullscreen();break}}onPageClick(n){let s=n.currentTarget.getBoundingClientRect(),a=n.clientX-s.left,l=s.width/2;a<l?this.prevPage():this.nextPage(),this.showControlsTemporarily()}onMouseMove(){this.showControlsTemporarily()}showControlsTemporarily(){this.showControls.set(!0),clearTimeout(this.controlTimeout),this.controlTimeout=setTimeout(()=>{this.isFullscreen()&&this.showControls.set(!1)},2e3)}prevPage(){this.currentPage()>0&&this.currentPage.update(n=>n-1)}nextPage(){this.currentPage()<this.pages().length-1&&this.currentPage.update(n=>n+1)}goToPage(n){n>=0&&n<this.pages().length&&this.currentPage.set(n)}toggleFullscreen(){this.isFullscreen.update(n=>!n),this.isFullscreen()?document.body.style.overflow="hidden":(document.body.style.overflow="",this.showControls.set(!0))}goToBuilder(){this.router.navigate(["/manga-builder"])}getCurrentPageUrl(){let n=this.pages(),e=this.currentPage();return n[e]?.url||""}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=y({type:c,selectors:[["app-manga-reader-page"]],hostBindings:function(e,s){e&1&&d("keydown",function(l){return s.onKeyDown(l)},P)},decls:26,vars:4,consts:[["emptyState",""],[1,"min-h-screen","text-dash-text","p-4","md:p-8","font-sans","selection:bg-dash-accent","selection:text-white","pb-16"],[1,"max-w-7xl","mx-auto","flex","flex-col","gap-4"],[1,"flex","items-center","justify-between","gradient-header","p-3","md:p-4","rounded-sm","sticky","top-0","z-50","shadow-lg"],[1,"flex","items-center","gap-2","md:gap-4"],["title","Menu",1,"w-10","h-10","bg-dash-bg","rounded-sm","flex","items-center","justify-center","hover:bg-dash-accent","cursor-pointer","text-dash-text-dim","hover:text-white","transition-all",3,"click"],[1,"material-symbols-sharp","text-xl"],[1,"text-xs","md:text-sm","font-bold","tracking-widest","text-dash-text-dim","uppercase"],["class","text-xs text-dash-text-dim truncate max-w-[200px]",4,"ngIf"],[1,"flex","gap-2","md:gap-4","items-center"],[1,"px-3","py-2","bg-dash-bg","rounded-sm","flex","items-center","gap-2","hover:bg-dash-accent","cursor-pointer","text-dash-text-dim","hover:text-white","transition-all","text-xs",3,"click"],[1,"material-symbols-sharp","text-sm"],[1,"hidden","md:inline"],[1,"px-3","py-2","bg-dash-bg","rounded-sm","flex","items-center","gap-2","hover:bg-dash-accent","cursor-pointer","text-dash-text-dim","hover:text-white","transition-all","text-xs"],["type","file","accept",".cbz,.zip",1,"hidden",3,"change"],["class","gradient-card rounded-sm flex flex-col items-center relative",3,"fixed","inset-0","z-[100]","rounded-none","mousemove",4,"ngIf","ngIfElse"],["class","fixed inset-0 bg-black/80 flex flex-col items-center justify-center gap-4 z-[200]",4,"ngIf"],[1,"text-xs","text-dash-text-dim","truncate","max-w-[200px]"],[1,"gradient-card","rounded-sm","flex","flex-col","items-center","relative",3,"mousemove"],[1,"flex-1","w-full","flex","items-center","justify-center","p-4","cursor-pointer","min-h-[60vh]",3,"click"],[1,"max-w-full","max-h-[70vh]","object-contain","select-none",3,"src","alt"],[1,"flex","items-center","gap-4","p-4","bg-dash-bg/80","backdrop-blur-sm","rounded-sm","mb-4"],[1,"w-10","h-10","bg-dash-border","rounded-sm","flex","items-center","justify-center","hover:bg-dash-accent","cursor-pointer","text-dash-text-dim","hover:text-white","transition-all","disabled:opacity-30","disabled:cursor-not-allowed",3,"click","disabled"],[1,"material-symbols-sharp"],[1,"flex","items-center","gap-2","text-sm","font-mono"],[1,"text-dash-accent","font-bold"],[1,"text-dash-text-dim"],[1,"w-10","h-10","bg-dash-border","rounded-sm","flex","items-center","justify-center","hover:bg-dash-accent","cursor-pointer","text-dash-text-dim","hover:text-white","transition-all","ml-2",3,"click"],[1,"w-full","max-w-md","px-4","pb-4"],["type","range",1,"w-full","h-1","bg-dash-border","rounded-sm","appearance-none","cursor-pointer","accent-dash-accent",3,"input","min","max","value"],[1,"gradient-card","rounded-sm","flex","flex-col","items-center","justify-center","py-16","px-4","text-center"],[1,"material-symbols-sharp","text-6xl","text-dash-text-dim","mb-4"],[1,"text-lg","font-bold","text-dash-text","mb-2"],[1,"text-sm","text-dash-text-dim","mb-6"],[1,"gradient-btn","text-white","px-4","py-2","rounded-sm","text-sm","font-medium","flex","items-center","gap-2","cursor-pointer"],[1,"mt-8","text-left","text-xs","text-dash-text-dim"],[1,"mb-2","font-medium"],[1,"space-y-1"],[1,"px-1.5","py-0.5","bg-dash-bg","rounded","text-[10px]"],[1,"fixed","inset-0","bg-black/80","flex","flex-col","items-center","justify-center","gap-4","z-[200]"],[1,"material-symbols-sharp","text-4xl","text-dash-accent","animate-spin"],[1,"text-dash-text"]],template:function(e,s){if(e&1){let a=v();t(0,"div",1)(1,"div",2)(2,"header",3)(3,"div",4)(4,"button",5),d("click",function(){return m(a),g(s.toggleSidebar())}),t(5,"span",6),r(6,"menu"),i()(),t(7,"h1",7),r(8,"Manga Reader"),i(),b(9,j,2,1,"span",8),i(),t(10,"div",9)(11,"button",10),d("click",function(){return m(a),g(s.goToBuilder())}),t(12,"span",11),r(13,"auto_stories"),i(),t(14,"span",12),r(15,"Builder"),i()(),t(16,"label",13)(17,"span",11),r(18,"folder_open"),i(),t(19,"span",12),r(20,"\xD6ffnen"),i(),t(21,"input",14),d("change",function(N){return m(a),g(s.onFileSelect(N))}),i()()()(),b(22,L,22,26,"div",15)(23,U,33,0,"ng-template",null,0,k)(25,z,5,0,"div",16),i()()}if(e&2){let a=E(24);o(9),u("ngIf",s.fileName()),o(13),u("ngIf",s.pages().length>0)("ngIfElse",a),o(3),u("ngIf",s.isLoading())}},dependencies:[T,M],encapsulation:2})};export{I as MangaReaderPage};
