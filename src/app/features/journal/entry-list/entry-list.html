<div class="flex flex-col h-full">
    <!-- Input Area (Fixed at top) -->
    <div class="p-6 border-b border-dash-border bg-dash-card z-10">
        <div class="relative">
            <textarea [(ngModel)]="newEntryText" (keydown)="onKeyDown($event)"
                class="w-full bg-dash-bg/50 border border-dash-border rounded-sm p-4 text-dash-text placeholder-dash-text-dim/50 h-24 resize-none focus:border-dash-accent focus:ring-1 focus:ring-dash-accent transition-all outline-none"
                placeholder="What's on your mind today?" autofocus></textarea>
            <div class="absolute bottom-3 right-3 text-[10px] text-dash-text-dim bg-dash-bg/80 px-2 py-1 rounded">
                CTRL+ENTER to save
            </div>
        </div>
    </div>

    <!-- Entries (Scrollable) -->
    <div class="flex-1 overflow-y-auto flex flex-col custom-scrollbar">
        <div class="p-6 flex flex-col gap-4">
            @for (entry of filteredEntries(); track entry.id) {
            <div class="bg-dash-bg/30 rounded-sm p-4 transition-all group relative"
                [class.border-2]="editingEntryId === entry.id || journal.hasDuplicateDate(entry)"
                [class.border-dashed]="editingEntryId === entry.id"
                [class.border-amber-400]="editingEntryId === entry.id && !journal.hasDuplicateDate(entry)"
                [class.border-red-500/60]="journal.hasDuplicateDate(entry) && editingEntryId !== entry.id"
                [class.border]="editingEntryId !== entry.id && !journal.hasDuplicateDate(entry)"
                [class.border-dash-border/50]="editingEntryId !== entry.id && !journal.hasDuplicateDate(entry)"
                [class.hover:border-dash-accent/50]="editingEntryId !== entry.id && !journal.hasDuplicateDate(entry)">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-2">
                        @if (editingDateId === entry.id) {
                        <input type="date" [value]="getIsoDate(entry.date)"
                            class="bg-dash-bg border border-dash-border rounded px-1 py-0.5 text-xs text-dash-text text-[10px] w-32 focus:outline-none focus:border-dash-accent"
                            (change)="saveDateEdit(entry, $event)" (blur)="cancelDateEdit()" autofocus>
                        } @else {
                        <span class="text-xs font-mono text-dash-accent">{{ entry.date | date:'MMM dd,
                            yyyy':'Europe/Vienna' }}</span>
                        <button class="text-dash-text-dim hover:text-dash-accent transition-colors"
                            (click)="startEditingDate(entry)" title="Edit Date">
                            <span class="material-symbols-sharp text-[10px]">edit</span>
                        </button>
                        }
                        @if (journal.hasDuplicateDate(entry)) {
                        <span class="text-[10px] text-red-400 font-medium">duplicate date</span>
                        }
                    </div>
                    <button class="text-dash-text-dim hover:text-red-400 transition-opacity"
                        (click)="deleteEntry(entry.id)" title="Delete">
                        <span class="material-symbols-sharp text-sm">delete</span>
                    </button>
                </div>

                <div class="relative">
                    @if (editingEntryId === entry.id) {
                    <textarea #editTextarea [(ngModel)]="editEntryText" (blur)="saveEdit()"
                        class="w-full bg-transparent text-sm text-dash-text resize-none focus:outline-none leading-relaxed whitespace-pre-wrap"
                        [style.height.px]="editingHeight" autofocus></textarea>
                    } @else {
                    <div (click)="startEditing(entry, $event)"
                        class="whitespace-pre-wrap text-sm text-dash-text/90 leading-relaxed cursor-pointer hover:text-dash-text transition-colors">
                        {{ entry.text }}
                    </div>
                    }
                </div>
            </div>
            } @empty {
            <div class="flex flex-col items-center justify-center h-full text-dash-text-dim opacity-50 py-12">
                <span class="material-symbols-sharp text-4xl mb-2">inbox</span>
                <span>No entries found</span>
            </div>
            }
        </div>
    </div>
</div>