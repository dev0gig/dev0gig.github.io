<div class="fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" (click)="closeModal()"></div>
    <div
        class="relative gradient-card p-4 sm:p-5 rounded-sm shadow-2xl w-full max-w-4xl flex flex-col sm:flex-row gap-4 sm:gap-6 accent-glow max-h-[90vh] overflow-y-auto">

        <!-- Left: Card Image -->
        <div class="w-full sm:w-96 flex-shrink-0">
            <div
                class="aspect-[5/7] overflow-hidden rounded-xl sm:rounded-2xl max-w-[200px] sm:max-w-none mx-auto sm:mx-0">
                @if (getDetails(card())?.imageUrl) {
                <img [src]="getDetails(card())!.imageUrl" [alt]="card().nameEN"
                    class="w-full h-full object-contain rounded-xl sm:rounded-2xl" />
                } @else {
                <div
                    class="w-full h-full bg-dash-bg flex flex-col items-center justify-center gap-2 rounded-xl sm:rounded-2xl">
                    @if (isLoading(card())) {
                    <span
                        class="material-symbols-sharp text-3xl sm:text-4xl text-dash-text-dim animate-pulse">image</span>
                    <span class="text-xs sm:text-sm text-dash-text-dim">Lädt...</span>
                    } @else {
                    <span
                        class="material-symbols-sharp text-3xl sm:text-4xl text-dash-text-dim opacity-50">playing_cards</span>
                    <span class="text-xs sm:text-sm text-dash-text-dim">Kein Bild</span>
                    }
                </div>
                }
            </div>
        </div>

        <!-- Right: Card Details -->
        <div class="flex-1 flex flex-col gap-2 sm:gap-3 min-w-0">
            <!-- Header with Rarity Badge -->
            <div class="flex items-start justify-between gap-2">
                <div class="flex flex-wrap items-center gap-2">
                    <h2 class="text-base sm:text-lg font-bold text-dash-text leading-tight">
                        {{ getDetails(card())?.nameDE || card().nameEN }}
                    </h2>
                    @if (getDetails(card())?.rarity) {
                    <span [class]="{
                        'bg-gray-600': getDetails(card())!.rarity === 'common',
                        'bg-gray-400': getDetails(card())!.rarity === 'uncommon',
                        'bg-yellow-600': getDetails(card())!.rarity === 'rare',
                        'bg-orange-500': getDetails(card())!.rarity === 'mythic'
                    }" class="text-[10px] uppercase font-bold px-2 py-0.5 rounded-full text-white">
                        {{ getDetails(card())!.rarity }}
                    </span>
                    }
                </div>
                <button (click)="closeModal()"
                    class="text-dash-text-dim hover:text-white transition-colors flex-shrink-0 -mt-1">
                    <span class="material-symbols-sharp">close</span>
                </button>
            </div>

            <!-- Card Info -->
            <div class="flex flex-col gap-1 sm:gap-1.5 text-xs sm:text-sm">
                <div class="flex justify-between">
                    <span class="text-dash-text-dim">English</span>
                    <span class="text-dash-text text-right">{{ card().nameEN }}</span>
                </div>
                @if (getDetails(card())?.setName) {
                <div class="flex justify-between">
                    <span class="text-dash-text-dim">Set</span>
                    <span class="text-dash-text text-right truncate ml-2">{{
                        getDetails(card())!.setName
                        }}</span>
                </div>
                }
                <div class="flex justify-between">
                    <span class="text-dash-text-dim">Code</span>
                    <span class="text-dash-text font-mono">{{ card().set }} #{{
                        card().collectorNumber }}</span>
                </div>
                @if (getDetails(card())?.manaCost) {
                <div class="flex justify-between">
                    <span class="text-dash-text-dim">Mana</span>
                    <span class="text-dash-text font-mono">{{ getDetails(card())!.manaCost
                        }}</span>
                </div>
                }
            </div>

            <!-- Legalities -->
            @if (getDetails(card())?.legalities) {
            <div class="bg-dash-bg p-2 sm:p-3 rounded-sm">
                <div class="text-[10px] sm:text-xs text-dash-text-dim uppercase tracking-wider mb-1.5 sm:mb-2">
                    Formate</div>
                <div class="flex flex-wrap gap-1 sm:gap-1.5">
                    @if (getDetails(card())?.legalities?.standard) {
                    <span
                        [class]="getDetails(card())!.legalities!.standard === 'legal' ? 'bg-green-600' : 'bg-red-600/50'"
                        class="text-[9px] sm:text-[10px] uppercase font-bold px-1.5 sm:px-2 py-0.5 rounded text-white">Standard</span>
                    }
                    @if (getDetails(card())?.legalities?.modern) {
                    <span
                        [class]="getDetails(card())!.legalities!.modern === 'legal' ? 'bg-green-600' : 'bg-red-600/50'"
                        class="text-[9px] sm:text-[10px] uppercase font-bold px-1.5 sm:px-2 py-0.5 rounded text-white">Modern</span>
                    }
                    @if (getDetails(card())?.legalities?.commander) {
                    <span
                        [class]="getDetails(card())!.legalities!.commander === 'legal' ? 'bg-green-600' : 'bg-red-600/50'"
                        class="text-[9px] sm:text-[10px] uppercase font-bold px-1.5 sm:px-2 py-0.5 rounded text-white">Commander</span>
                    }
                    @if (getDetails(card())?.legalities?.pioneer) {
                    <span
                        [class]="getDetails(card())!.legalities!.pioneer === 'legal' ? 'bg-green-600' : 'bg-red-600/50'"
                        class="text-[9px] sm:text-[10px] uppercase font-bold px-1.5 sm:px-2 py-0.5 rounded text-white">Pioneer</span>
                    }
                    @if (getDetails(card())?.legalities?.legacy) {
                    <span
                        [class]="getDetails(card())!.legalities!.legacy === 'legal' ? 'bg-green-600' : 'bg-red-600/50'"
                        class="text-[9px] sm:text-[10px] uppercase font-bold px-1.5 sm:px-2 py-0.5 rounded text-white">Legacy</span>
                    }
                    @if (getDetails(card())?.legalities?.pauper) {
                    <span
                        [class]="getDetails(card())!.legalities!.pauper === 'legal' ? 'bg-green-600' : 'bg-red-600/50'"
                        class="text-[9px] sm:text-[10px] uppercase font-bold px-1.5 sm:px-2 py-0.5 rounded text-white">Pauper</span>
                    }
                </div>
            </div>
            }

            <!-- EUR Prices -->
            <div class="flex flex-col gap-1.5 sm:gap-2">
                <div class="flex items-center justify-between">
                    <span class="text-[10px] sm:text-xs text-dash-text-dim uppercase tracking-wider">Preise</span>
                    <button (click)="refreshPrices()" [disabled]="isRefreshingPrices()"
                        class="flex items-center gap-1 px-2 py-1 text-[10px] sm:text-xs bg-dash-bg hover:bg-dash-accent rounded-sm text-dash-text-dim hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        title="Preise aktualisieren">
                        @if (isRefreshingPrices()) {
                        <span class="material-symbols-sharp text-sm animate-spin">progress_activity</span>
                        } @else {
                        <span class="material-symbols-sharp text-sm">refresh</span>
                        }
                        <span class="hidden sm:inline">Aktualisieren</span>
                    </button>
                </div>
                @if (getDetails(card())?.priceEur) {
                <div class="bg-dash-bg p-2 sm:p-3 rounded-sm flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-sharp text-dash-accent text-base sm:text-lg">payments</span>
                        <span class="text-xs sm:text-sm text-dash-text-dim">Preis</span>
                    </div>
                    <span class="font-bold text-lg sm:text-xl text-green-400">€{{
                        getDetails(card())!.priceEur }}</span>
                </div>
                }
                @if (getDetails(card())?.priceEurFoil) {
                <div class="bg-dash-bg p-2 sm:p-3 rounded-sm flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-sharp text-yellow-400 text-base sm:text-lg">auto_awesome</span>
                        <span class="text-xs sm:text-sm text-dash-text-dim">Foil</span>
                    </div>
                    <span class="font-bold text-lg sm:text-xl text-yellow-400">€{{
                        getDetails(card())!.priceEurFoil }}</span>
                </div>
                } @else if (!getDetails(card())?.priceEur) {
                <div class="bg-dash-bg p-2 sm:p-3 rounded-sm text-center text-dash-text-dim text-xs sm:text-sm">
                    Keine Preisdaten verfügbar
                </div>
                }
            </div>

            <!-- Cardmarket Link -->
            @if (getDetails(card())?.cardmarketUrl) {
            <a [href]="getDetails(card())!.cardmarketUrl" target="_blank" rel="noopener"
                class="bg-blue-600 hover:bg-blue-500 p-2 sm:p-3 rounded-sm flex items-center justify-center gap-2 text-white font-bold transition-colors text-sm">
                <span class="material-symbols-sharp text-base sm:text-lg">shopping_cart</span>
                Auf Cardmarket kaufen
            </a>
            }

            <!-- Quantity Controls -->
            <div class="flex items-center justify-between border-t border-dash-border pt-2 sm:pt-3 mt-auto">
                <div class="flex items-center gap-2">
                    <span class="text-dash-text-dim text-xs sm:text-sm">Anzahl:</span>
                    <div class="flex items-center gap-1">
                        <button (click)="updateQuantity(card(), -1)"
                            class="w-8 h-8 bg-dash-bg hover:bg-red-600 hover:text-white rounded-sm flex items-center justify-center transition-colors text-dash-text-dim">
                            <span class="material-symbols-sharp text-sm">remove</span>
                        </button>
                        <span class="w-8 sm:w-10 text-center font-bold text-base sm:text-lg text-dash-text">
                            {{ getCardCount(card()) }}
                        </span>
                        <button (click)="updateQuantity(card(), 1)"
                            class="w-8 h-8 bg-dash-bg hover:bg-green-600 hover:text-white rounded-sm flex items-center justify-center transition-colors text-dash-text-dim">
                            <span class="material-symbols-sharp text-sm">add</span>
                        </button>
                    </div>
                </div>
                <button (click)="removeCard(index())"
                    class="px-2 sm:px-3 py-2 text-red-400 hover:bg-red-600 hover:text-white rounded-sm transition-colors flex items-center gap-1 text-xs sm:text-sm"
                    title="Alle Kopien entfernen">
                    <span class="material-symbols-sharp text-sm">delete</span>
                    <span class="hidden sm:inline">Entfernen</span>
                </button>
            </div>
        </div>
    </div>
</div>